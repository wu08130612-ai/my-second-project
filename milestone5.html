<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é‡Œç¨‹ç¢‘5 - 3Däº¤äº’å¼å¡ç‰‡ç½‘æ ¼</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #111;
            color: #fff;
            font-family: 'Arial', sans-serif;
            overflow-x: hidden;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* 3Dé€è§†å®¹å™¨ - å…³é”®çš„perspectiveè®¾ç½® */
        .grid-container {
            perspective: 1000px;
            perspective-origin: center center;
            padding: 50px;
        }

        /* CSS Grid 3x3å¸ƒå±€ */
        .cards-grid {
            display: grid;
            grid-template-columns: repeat(3, 300px);
            grid-template-rows: repeat(3, 200px);
            gap: 30px;
            transform-style: preserve-3d;
        }

        /* å¡ç‰‡æ ·å¼ - ä¸¥æ ¼æŒ‰ç…§éœ€æ±‚ */
        .card {
            width: 300px;
            height: 200px;
            background: #222;
            border: 1px solid #444;
            border-radius: 10px;
            
            /* å…³é”®çš„transition - è®©å€¾æ–œåŠ¨ç”»å¹³æ»‘ */
            transition: transform 0.1s ease-out;
            
            /* å¾®å¦™çš„é˜´å½± */
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            
            /* 3Då˜æ¢å‡†å¤‡ */
            transform-style: preserve-3d;
            
            /* å¡ç‰‡å†…å®¹å±…ä¸­ */
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 18px;
            font-weight: bold;
            color: #888;
        }

        /* è°ƒè¯•ä¿¡æ¯æ ·å¼ */
        .debug-info {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.8);
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            line-height: 1.4;
            z-index: 1000;
        }
    </style>
</head>
<body>
    <!-- è°ƒè¯•ä¿¡æ¯é¢æ¿ -->
    <div class="debug-info" id="debugInfo">
        <div>é¼ æ ‡ä½ç½®: <span id="mousePos">0, 0</span></div>
        <div>æ´»è·ƒå¡ç‰‡: <span id="activeCard">æ— </span></div>
        <div>æœ€å¤§å€¾æ–œ: <span id="maxTilt">0Â°</span></div>
    </div>

    <!-- 3Dé€è§†å®¹å™¨ -->
    <div class="grid-container">
        <!-- 3x3å¡ç‰‡ç½‘æ ¼ -->
        <div class="cards-grid" id="cardsGrid">
            <div class="card" data-index="0">å¡ç‰‡ 1</div>
            <div class="card" data-index="1">å¡ç‰‡ 2</div>
            <div class="card" data-index="2">å¡ç‰‡ 3</div>
            <div class="card" data-index="3">å¡ç‰‡ 4</div>
            <div class="card" data-index="4">å¡ç‰‡ 5</div>
            <div class="card" data-index="5">å¡ç‰‡ 6</div>
            <div class="card" data-index="6">å¡ç‰‡ 7</div>
            <div class="card" data-index="7">å¡ç‰‡ 8</div>
            <div class="card" data-index="8">å¡ç‰‡ 9</div>
        </div>
    </div>

    <script>
        // 3Däº¤äº’å¼å¡ç‰‡ç½‘æ ¼ç³»ç»Ÿ
        // é«˜æ€§èƒ½æ–¹æ¡ˆï¼šå…¨ç¨‹ä½¿ç”¨transformï¼ŒGPUåŠ é€Ÿ
        
        // é…ç½®å‚æ•°
        const CONFIG = {
            maxTiltAngle: 15,        // æœ€å¤§å€¾æ–œè§’åº¦
            effectRadius: 300,       // å½±å“åŠå¾„
            transitionDuration: 0.1  // è¿‡æ¸¡æ—¶é—´
        };

        // å…¨å±€çŠ¶æ€
        let cards = [];
        let cardCenters = [];
        let isInitialized = false;

        // è°ƒè¯•å…ƒç´ 
        const debugInfo = {
            mousePos: document.getElementById('mousePos'),
            activeCard: document.getElementById('activeCard'),
            maxTilt: document.getElementById('maxTilt')
        };

        // åˆå§‹åŒ–ç³»ç»Ÿ
        function initializeCardSystem() {
            console.log('ğŸš€ åˆå§‹åŒ–3Då¡ç‰‡ç³»ç»Ÿ...');
            
            // è·å–æ‰€æœ‰å¡ç‰‡
            cards = document.querySelectorAll('.card');
            console.log(`ğŸ“¦ æ‰¾åˆ° ${cards.length} ä¸ªå¡ç‰‡`);
            
            // è®¡ç®—æ¯ä¸ªå¡ç‰‡çš„ä¸­å¿ƒä½ç½®
            calculateCardCenters();
            
            // ç»‘å®šå…¨å±€é¼ æ ‡äº‹ä»¶
            bindGlobalMouseEvents();
            
            isInitialized = true;
            console.log('âœ… 3Då¡ç‰‡ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆ');
        }

        // è®¡ç®—å¡ç‰‡ä¸­å¿ƒä½ç½®
        function calculateCardCenters() {
            cardCenters = [];
            
            cards.forEach((card, index) => {
                const rect = card.getBoundingClientRect();
                const centerX = rect.left + rect.width / 2;
                const centerY = rect.top + rect.height / 2;
                
                cardCenters.push({ x: centerX, y: centerY });
                
                console.log(`ğŸ“ å¡ç‰‡${index + 1}ä¸­å¿ƒ: (${centerX.toFixed(1)}, ${centerY.toFixed(1)})`);
            });
        }

        // è·ç¦»è¡°å‡ç®—æ³• - ä½¿ç”¨ç°ä»£Math.hypot
        function calculateTiltIntensity(mouseX, mouseY, cardCenterX, cardCenterY) {
            // ä½¿ç”¨Math.hypotè®¡ç®—ç›´çº¿è·ç¦»
            const distance = Math.hypot(mouseX - cardCenterX, mouseY - cardCenterY);
            
            // è·ç¦»è¡°å‡å…¬å¼ï¼šå¼ºåº¦ = max(0, 1 - è·ç¦»/åŠå¾„)
            const intensity = Math.max(0, 1 - distance / CONFIG.effectRadius);
            
            return { distance, intensity };
        }

        // è®¡ç®—3Då€¾æ–œè§’åº¦
        function calculate3DTilt(mouseX, mouseY, cardCenterX, cardCenterY, intensity) {
            // è®¡ç®—ç›¸å¯¹ä½ç½®
            const deltaX = mouseX - cardCenterX;
            const deltaY = mouseY - cardCenterY;
            
            // è®¡ç®—å€¾æ–œè§’åº¦ï¼ˆåå‘ï¼Œè®©å¡ç‰‡"çœ‹å‘"é¼ æ ‡ï¼‰
            const tiltX = -(deltaY / CONFIG.effectRadius) * CONFIG.maxTiltAngle * intensity;
            const tiltY = (deltaX / CONFIG.effectRadius) * CONFIG.maxTiltAngle * intensity;
            
            return { tiltX, tiltY };
        }

        // åº”ç”¨3Då˜æ¢ - é«˜æ€§èƒ½transformæ–¹æ¡ˆ
        function applyCardTransform(card, tiltX, tiltY) {
            // çº¯transformæ–¹æ¡ˆï¼ŒGPUåŠ é€Ÿï¼Œé›¶reflow
            card.style.transform = `rotateX(${tiltX}deg) rotateY(${tiltY}deg)`;
        }

        // å…¨å±€é¼ æ ‡ç§»åŠ¨å¤„ç†
        function handleGlobalMouseMove(event) {
            if (!isInitialized) return;
            
            const mouseX = event.clientX;
            const mouseY = event.clientY;
            
            // æ›´æ–°è°ƒè¯•ä¿¡æ¯
            debugInfo.mousePos.textContent = `${mouseX}, ${mouseY}`;
            
            let maxTiltValue = 0;
            let activeCardIndex = -1;
            
            // éå†æ‰€æœ‰å¡ç‰‡ï¼Œåº”ç”¨3Dæ•ˆæœ
            cards.forEach((card, index) => {
                const cardCenter = cardCenters[index];
                
                // è®¡ç®—è·ç¦»å’Œå¼ºåº¦
                const { distance, intensity } = calculateTiltIntensity(
                    mouseX, mouseY, cardCenter.x, cardCenter.y
                );
                
                if (intensity > 0) {
                    // è®¡ç®—3Då€¾æ–œ
                    const { tiltX, tiltY } = calculate3DTilt(
                        mouseX, mouseY, cardCenter.x, cardCenter.y, intensity
                    );
                    
                    // åº”ç”¨å˜æ¢
                    applyCardTransform(card, tiltX, tiltY);
                    
                    // è®°å½•æœ€å¤§å€¾æ–œå€¼
                    const totalTilt = Math.hypot(tiltX, tiltY);
                    if (totalTilt > maxTiltValue) {
                        maxTiltValue = totalTilt;
                        activeCardIndex = index;
                    }
                } else {
                    // è¶…å‡ºå½±å“èŒƒå›´ï¼Œé‡ç½®ä¸ºé™æ­¢çŠ¶æ€
                    applyCardTransform(card, 0, 0);
                }
            });
            
            // æ›´æ–°è°ƒè¯•ä¿¡æ¯
            debugInfo.maxTilt.textContent = `${maxTiltValue.toFixed(1)}Â°`;
            debugInfo.activeCard.textContent = activeCardIndex >= 0 ? `å¡ç‰‡ ${activeCardIndex + 1}` : 'æ— ';
        }

        // ç»‘å®šå…¨å±€äº‹ä»¶
        function bindGlobalMouseEvents() {
            // å…¨å±€é¼ æ ‡ç§»åŠ¨ç›‘å¬
            window.addEventListener('mousemove', handleGlobalMouseMove);
            
            // çª—å£å¤§å°æ”¹å˜æ—¶é‡æ–°è®¡ç®—å¡ç‰‡ä½ç½®
            window.addEventListener('resize', () => {
                setTimeout(calculateCardCenters, 100);
            });
            
            console.log('ğŸ¯ å…¨å±€é¼ æ ‡äº‹ä»¶ç»‘å®šå®Œæˆ');
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', initializeCardSystem);
        
        // é˜²æ­¢é¡µé¢åˆ·æ–°æ—¶çš„é—ªçƒ
        window.addEventListener('load', () => {
            document.body.style.opacity = '1';
        });
    </script>
</body>
</html>